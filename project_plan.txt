# Project Plan: 2D Web Game

## 1. User Needs Analysis
**Target Audience**
- Casual gamers accessing the game via modern web browsers (desktop & mobile).

**Core Workflow & Pain Points**
- Users want an immediate, noâ€‘install experience: load the game URL and start playing.
- Simple controls (keyboard for desktop, onâ€‘screen touch controls for mobile).
- Low latency and smooth 60â€¯fps rendering.
- Ability to pause, restart levels, and track high scores.
- Optional sharing of scores on social media.

**Feature Prioritization**
1. **Playable core loop** â€“ player can move, jump, interact, and complete a short level.
2. **Responsive controls** â€“ keyboard + touch UI.
3. **Scoring & persistence** â€“ local storage highâ€‘score table.
4. **Basic UI** â€“ start menu, pause screen, level complete screen.
5. **Graphics & Audio** â€“ simple spriteâ€‘sheet animation, background music, sound effects.
6. **Optional** â€“ social sharing, level editor, leaderboard server.

**Usability & UX**
- Clear visual feedback (animation, particle effects).
- Minimal loading times; assets preâ€‘loaded.
- Consistent UI layout across devices.
- Accessibility: colorâ€‘blind friendly palette, configurable key bindings.

## 2. Rapid Development Architecture
**Technology Stack (speedâ€‘first)**
- **HTML5 + CSS3** â€“ static page layout.
- **JavaScript (ES2023)** â€“ core game logic.
- **PixiJS** â€“ lightweight 2D rendering engine (canvas/WebGL fallback).
- **Howler.js** â€“ simple audio handling.
- **LocalStorage API** â€“ persistence of scores/settings.
- **Parcel** (zeroâ€‘config bundler) â€“ fast builds, hot reload for development.
- **Jest** â€“ unit & integration testing.
- **Playwright** â€“ user workflow (endâ€‘toâ€‘end) tests in headless Chromium.

**Data Storage**
- All game assets (sprites, audio) stored in `/assets`.
- Game state and high scores saved in `localStorage` via a tiny wrapper module.

**MVP Approach**
- Iteration 0: Static page with canvas placeholder.
- Iteration 1: Player sprite + movement & collision.
- Iteration 2: Simple level layout (tiles), goal object, scoring.
- Iteration 3: UI screens, pause/resume, highâ€‘score persistence.
- Iteration 4: Polish â€“ animations, sounds, responsive touch controls.

**Framework & Library Selections**
- **PixiJS** for rapid sprite handling and physicsâ€‘free collision detection.
- **Parcel** eliminates need for custom webpack config; supports hot module reload.
- **Jest** provides fast unit-test execution; no external services required.
- **Playwright** runs in the same headless Docker environment, satisfying workflow tests.

## 3. Core Functionality Implementation
| Feature | Description | Priority |
|---------|-------------|----------|
| Game Loop | RequestAnimationFrame driven update/render cycle | âœ… |
| Player Controller | Keyboard (â† â†’ â†‘ space) & touch joystick/buttons | âœ… |
| Tileâ€‘based Level | Simple JSON map â†’ collision grid | âœ… |
| Goal & Scoring | Collectible object ends level, increments score | âœ… |
| UI Screens | Start, pause, level complete, highâ€‘score display | âœ… |
| Asset Loader | Preload spritesheet, audio, show loading bar | âœ… |
| Persistence | Save/retrieve high scores from localStorage | âœ… |
| Audio System | Background music loop + SFX triggers | ğŸ¯ (niceâ€‘toâ€‘have for first MVP) |
| Responsive Design | CSS media queries & touch UI scaling | ğŸ¯ |
| Social Share | Share score via Web Share API | ğŸ¯ (future) |
| Level Editor | Inâ€‘browser editor for custom maps | ğŸ¯ (future) |

**Integration Points**
- `src/renderer.js` (PixiJS canvas)
- `src/input.js` (keyboard & touch)
- `src/level.js` (loads JSON map)
- `src/ui.js` (DOM overlays)
- `src/storage.js` (localStorage wrapper)

## 4. Testâ€‘Driven Development Strategy

### 4.1 Testing Hierarchy
1. **Unit Tests â€“ Simple Cases First**
   - Pure functions: `collisionDetection`, `scoreCalculator`, `storage.getHighScore`.
   - Player movement logic (velocity clamping, jump cooldown).
2. **Integration Tests â€“ Minimal Setup**
   - Renderer creates Pixi Application with mocked canvas.
   - Level loader parses JSON and builds collision grid.
   - Storage module writes/reads from a temporary `localStorage` mock.
3. **User Workflow Tests â€“ Critical Paths Only**
   - Endâ€‘toâ€‘end: Load page â†’ start game â†’ complete level â†’ highâ€‘score appears.
   - Pause/resume flow.
   - Touch control path on simulated mobile viewport.

### 4.2 Mocking Strategy
- **Dependency Injection**: Modules receive `renderer`, `audio`, `storage` objects via constructor.
- **Simple Stubs**: Fake `Audio` object that records `play` calls.
- **System Boundary Mocks**: Mock `localStorage` using Jest's `jest.spyOn` on a fresh `window` object.
- **File System**: Tests use inâ€‘memory objects; no real file I/O.

### 4.3 Testing Tools & Frameworks
- **Jest** â€“ test runner, assertion library, builtâ€‘in mocking.
- **Playwright** â€“ headless Chromium for workflow tests; runs inside container without extra services.
- **Testing Patterns**
  - `describe`/`it` blocks mirroring feature hierarchy.
  - `beforeEach/afterEach` to reset mocks and DOM.
  - Snapshot testing for rendered Pixi stage JSON (lightweight verification).

### 4.4 Test Data Management
- Level JSON fixtures stored in `test/fixtures/level1.json`.
- Temporary `localStorage` cleared in `afterEach`.
- Playwright creates a fresh browser context per test, ensuring isolation.

## 5. Testabilityâ€‘First Design Guidelines
- **Composition over Inheritance**: Game objects composed of `position`, `velocity`, `sprite` components.
- **SRP**: Separate `PhysicsEngine`, `InputHandler`, `RenderSystem`, `GameState`.
- **Avoid Static Dependencies**: No global singletons; all modules export factory functions.
- **Business Logic Isolation**: Collision, scoring, and state transitions live in pure modules.
- **Localâ€‘First**: All features work offline; no external APIs required.

## 6. Development Workflow Optimization
- **Iterative Development**: Feature branches per iteration, each with failing tests first.
- **Fail Fast**: `npm test --watch` runs on file save; CI (within container) runs all suites on push.
- **Success Criteria**
  - Unit tests â‰¥ 80â€¯% coverage.
  - Integration tests pass on real Pixi canvas (headless mode).
  - Workflow test completes level in <â€¯5â€¯seconds without errors.
- **Debugging Support**
  - Central logger (`src/logger.js`) routes to console with level control.
  - Pixi's `renderer` exposes `stage` for inspection in dev tools.

## 7. Deployment and Distribution
- **Build Output**: `dist/` folder containing `index.html`, bundled `main.js`, assets.
- **Local Installation**: Users open `index.html` directly or serve via any static server (`npx serve dist`).
- **Simple Hosting**: GitHub Pages or Netlify â€“ oneâ€‘click deployment from `dist`.
- **Onboarding Docs**
  - `README.md` with play instructions, controls list, and browser compatibility.
  - Inâ€‘game tutorial overlay on first launch.
- **Update Strategy**
  - Versioned releases; cacheâ€‘busting via hash in bundled filename (handled by Parcel).
  - Autoâ€‘update prompt could be added later (service worker).

---
*Prepared by the AI Project Manager for rapid prototyping of a 2D web game.*  
